---
title: 还没抢到 HPV？试试这串 JS
date: 2019-11-20 23:42:11
tags: HPV
categories: 前端
thumbnail: hpv.png
---

年初时候了解到了 HPV，几个月里，经历了若干次失败的尝试，功夫不负有心人，今天终于如愿抢到了疫苗。我决定将我期间的经历和尝试记录下来，如果你也有需要，不妨看一看。

<!--more-->

## 什么是 HPV

HPV 英文名称 Human papillomavirus，西医学名“人乳头瘤病毒”，是一个拥有一百多种型号的家族。在女性恶性肿瘤中，宫颈癌的发病率仅次于乳腺癌，超过90%的宫颈癌病例都与 HPV 感染有关。HPV 有三种类型：二价、四价、九价，下面是简单的对比表：

|      疫苗种类       |       二价        |                四价                |               九价               |
| :-----------------: | :---------------: | :--------------------------------: | :------------------------------: |
| 有效预防的 HPV 型号 |       6，18       |           6，11，16，18            | 6，11，16，18，31，33，45，52，58 |
| 国内规定的接种年龄  |     9-45周岁      |             20-45周岁              |            16-26周岁             |
|      接种时间       |    0，1，6个月    |            0，2，6个月             |           0，2，6个月            |
|   参考价格（3针）   |      1740元       |               2394元               |              3894元              |
|      主要功能       | 预防84.5%的宫颈癌 | 预防84.5%的宫颈癌金和90%的生殖器疣 | 预防92.1%的宫颈癌和90%的生殖器疣 |

## 杭州及周边疫苗预约信息

从2019年2月27日至今，我吐血整理了微信公众号“杭州本地宝”中发布过的四价和九价的疫苗预约点，若几次开放的数据不一致，以最近的为准，具体信息如下：

|     预约点     | HPV 类型（价） |  预约方式   |                预约条件                | 开放人数/次 |
| :------------: | :------------: | :---------: | :------------------------------------: | :---------: |
|    杭州东新    |     四/九      |   问卷星    |                不限户籍                |     100     |
|    杭州湖滨    |       九       |   问卷星    |                不限户籍                |     100     |
|    杭州凯旋    |       九       |   支付宝    |                不限户籍                |   230/350   |
|    杭州凯旋    |       四       |    现场     |                不限户籍                |     100     |
|    杭州朝晖    |       四       | 电话/问卷星 |                不限户籍                |   50～60    |
|    杭州西溪    |       四       |   问卷星    |                不限户籍                |    不明     |
|   杭州米市巷   |       四       |   问卷星    |                不限户籍                |     40      |
|    杭州灵隐    |       九       |   问卷星    |                不限户籍                |  100～300   |
|    杭州清波    |       九       |   问卷星    |                不限户籍                |     100     |
|    杭州半山    |       九       |   问卷星    |                不限户籍                |     20      |
|  杭州钱塘新区  |       九       |  网络登记   |                不限户籍                |     120     |
|    杭州余杭    |       九       |   问卷星    | 余杭户籍/参保人员/辖区内学生/持居住证  |    2000     |
|    杭州萧山    |       九       |    摇号     |         萧山户籍/参保地在萧山          |    100+     |
|    杭州滨江    |       九       |    摇号     |         滨江户籍/参保地在滨江          |     200     |
|   杭州大江东   |       九       |    摇号     |   大江东范围户籍/住大江东范围满3个月   |    100+     |
| 杭州建德新安江 |       九       |    现场     |         建德户籍/住建德满3个月         |     100     |
|    杭州富阳    |       九       |  网络预约   |         富阳户籍/住富阳满3个月         |     120     |
|    绍兴新昌    |       九       |  官方微信   |         新昌户籍/住新昌满3个月         |     200     |
|    绍兴上虞    |       九       |    现场     |         上虞户籍/住上虞满3个月         |    不明     |
|    绍兴诸暨    |       九       |    电话     |                不限户籍                |    不明     |
|    绍兴越城    |       九       |    现场     |                不限户籍                |  150～200   |
| 绍兴柯桥/市区  |       九       |  官方微信   |  不限户籍，但需先到医院门诊激活就诊卡  |   10～100   |
|      金华      |     四/九      | 微信小程序  | 金华市各区户籍或持金华市社会保障市民卡 |   90～225   |
|      舟山      |       九       | 电话、现场  |          不限户籍、本辖区优先          |    不明     |
|      衢州      |       九       |    现场     |                不限户籍                |     800     |
|      嘉兴      |       九       |    电话     |  户籍地或居住地在南湖（经开）区范围内  |     200     |
|      海宁      |       九       |    网址     |                海宁户籍                |     150     |
|      临海      |       九       |  网络预约   |                不限户籍                |     30      |
|      台州      |       九       |   问卷星    |                不限户籍                |     41      |
|    宁波海曙    |       九       |    现场     |                不限户籍                |    不明     |
|    宁波各区    |       九       | 金苗宝 App  |                不限户籍                |    不明     |
|      ...       |     四/九      |     ...     |                  ...                   |     ...     |

这里我要先吐槽一下几个小坑的预约经历：

1. **金苗宝 App**，它的使用率在宁波各大医院和社区服务中心的使用率还是蛮高的，尤其是 HPV 疫苗和流感疫苗基本上都是通过这个 App 预约，但是我试过两次，都是接近预约时间，预约功能就处于瘫痪状态，估计服务器内存不够，大量请求同时访问，高并发导致服务器处于超负荷状态（我猜的）。
2. **杭州钱塘新区7个公众号的疫苗预约**，这次预约消息是很早就放出来的，总结了前几次憨憨的失败经验，我决定借助一点技术手段，这次很容易就从页面中抓出了7个POST请求的 Request URL 和 body，查阅网上资料现学写了一个 shell 脚本，摩拳擦掌跃跃欲试，只待良辰一到，可是现实再一次打击了我，居然还是没有抢到？！！后面再 review 了一下我的脚本，发现应该把七个请求做定时任务，进行异步执行。

现在言归正传，杭州周边地区的预约地点对户籍和居住条件有限制，且多为现场或电话预约。**近来疫苗供应有多起来的趋势**，如果不是想打九价的女生即将超过26周岁或者有其它急迫的理由，不太建议大家离开自己的所在地区打疫苗，一来是无法刷医保，二来来回交通和时间成本也比较高。因此我建议：

**浙江省内（非杭州）户籍的女生**：关注自己户籍所在地的疾控中心微信公众号，如富阳疾控、嘉兴疾控等，及时跟进公众号发布的信息。

**萧山、余杭、大江东、滨江户籍或参保地在这四地的女生**：不要错过摇号的时间，毕竟其他区的女生都得不到这个机会。

**其他女生**：能尝试的都可以试一下，尤其是江干凯旋中心的支付宝预约和杭州主城区各街道提供的的问卷星预约。输入问卷时，可以事先在输入法里设置快捷键，输入简单的字符串就能弹出个人信息，这样速度又快，也不担心填错。如果还是不行，下面介绍的小技巧，也许对你有帮助。

### 支付宝抢疫苗攻略

支付宝预约页面和微信不一样，他允许提早填好信息，非本人也可以帮忙预约，且页面上有倒计时，你只需要掐好提交按钮 enable 的时间，就看谁手速更快，网速更好了。

根据成功人士的建议：一定要提早十多分钟进页面填好信息，**千万不要中途退出**！！！亲测在有次手贱退出去了，然后就一直在页面上欣赏蚂蚁了（手动微笑）。

## 问卷星抢疫苗攻略

问卷星是我成功抢到疫苗的渠道，之前几个预约点在微信公众号里提供的问卷星链接是可以在电脑网页里打开的，当时我查看了一下它的前端代码，大概是这样：

![问卷 html 代码](hpv-html.png)

这令我们发现问卷星的几个输入框其实是有明显规律的，输入的值会成为 id 分别为 q1、q2、q3、q4 的元素的value，哪怕问卷中的问题顺序发生了调整，我们也只需要通过模糊匹配，找到对应的 div id 和 input id 即可。

基本上预约信息上需要填写的不外乎**姓名、联系方式、身份证、年龄**等，这样你就可以引用下面这串 JS。

```js
javascript: void((function() {
    if ($("div1") == null) {
        setTimeout(function() {
            location.reload()
        },
        100);
        return;
    }
    var hash = [["这里换成你的真实姓名", /(姓名)|(名字)/], ["这里换成你的手机号", /(手机)|(联系方式)/], ["这里换成你的年龄（周岁）", /(年龄)/], ["这里换成你的身份证", /(身份证)|(证件)/], ];
    function $(a) {
        return document.getElementById(a)
    }
    for (var i = 1;; i++) {
        if ($("div" + i) == null) break;
        if (!$("q" + i)) continue;
        var title = $("div" + i).innerHTML;
        for (var j = 0; j < hash.length; j++) {
            if (hash[j][1].test(title)) {
                $("q" + i).value = hash[j][0];
                break;
            }
        }
    }
})());
function validate() {
    return true;
}
```

打开浏览器的开发者模式，在控制台中粘贴这串 JS，回车，网页上就会自动注入信息。

![](inject-js.png)

10月30日这一天，因为写好了这个“外挂”，我对抢疫苗非常信心满满，不料这次他们设置了“只允许从微信中填写” 和“获取微信用户昵称、性别等（需登录）”，可见问卷设计者也在和我们在斗智斗勇啊🤦‍♀️。

![](you-should-login-wechat.png)

第一个解决起来也很简单，只需要用微信开发者工具打开网址即可。但是第二种我暂时没有找到解决方案，因为按照[微信官方文档](https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Web_Developer_Tools.html)中所说，**微信开发者工具只能调试自己账号绑定过的公众平台**，不过好在这次下城区东新街道社区卫生服务中心没有强制要求微信登录。

最后，再感叹一下技术改变生活，nice～

---

> （2020年2月2日更新）前几天有网友给我提了一个 issue，我又重新去研究了一下微信 OAuth2 授权和自动化脚本的问题，相关结论也在 [issue](https://github.com/fiteen/fiteen.github.io/issues/1) 中回复，有兴趣可以在下面交流。