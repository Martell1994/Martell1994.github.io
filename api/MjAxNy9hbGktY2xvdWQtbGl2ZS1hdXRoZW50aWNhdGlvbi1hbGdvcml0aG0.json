{"title":"阿里云直播鉴权算法","date":"2017-06-29T10:30:49.000Z","date_formatted":{"ll":"Jun 29, 2017","L":"06/29/2017","MM-DD":"06-29"},"link":"2017/ali-cloud-live-authentication-algorithm","comments":true,"tags":["直播"],"categories":["算法"],"updated":"2020-03-02T18:36:28.000Z","content":"<blockquote>\n<p>阿里云官方给出的文档：<a href=\"https://help.aliyun.com/document_detail/45210.html?spm=5176.2020520107.108.2.kYdTTA\" target=\"_blank\">用户指南-直播鉴权</a></p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h2 id=\"参数描述\">参数描述<a href=\"#参数描述\" title=\"参数描述\"></a></h2><p>要配置出正确的鉴权，需要明确以下几个参数：</p>\n<p><strong>推流地址</strong></p>\n<p>完整的推流地址，形如：</p>\n<p><code>rtmp://video-center.alivecdn.com/{AppName}/{StreamName}?vhost={yourdomain}</code></p>\n<p><strong>鉴权类型</strong></p>\n<p>阿里云CDN 兼容并支持 A、B、C 三种鉴权方式，具体见<a href=\"https://intl.aliyun.com/help/zh/doc-detail/27135.htm\" target=\"_blank\">URL 鉴权方式</a>。这里选择的是 A 类型</p>\n<p><strong>鉴权KEY</strong></p>\n<p><code>privatekey</code> 字段用户可以自行设置</p>\n<p><strong>时间戳</strong></p>\n<p>时间戳是指格林威治时间1970年01月01日00时00分00秒(北京时间1970年01月01日08时00分00秒)起至现在的总秒数。</p>\n<p><strong>有效时间</strong></p>\n<p>以秒为单位的整数时间，用来控制直播推流时效</p>\n<h2 id=\"鉴权方法\">鉴权方法<a href=\"#鉴权方法\" title=\"鉴权方法\"></a></h2><p> 用户访问加密 URL ：</p>\n<blockquote>\n<p>rtmp://video-center.alivecdn.com/{AppName}/{StreamName}?vhost={yourdomain}&amp;auth_key={timestamp}-{rand}-{uid}-{hashvalue}</p>\n</blockquote>\n<div class=\"φcz\"><div class=\"φdb\"><table><thead><tr>\n<th>auth_key字段</th><th>描述</th></tr>\n</thead><tbody><tr>\n<td>timestamp</td><td>失效时间=时间戳+有效时间，CDN 服务器拿到请求后，首先会判断请求中的失效时间是否小于当前时间，如果小于，则认为过期失效并返回 HTTP 403 错误。</td></tr>\n<tr>\n<td>rand</td><td>随机数，一般设成0</td></tr>\n<tr>\n<td>uid</td><td>暂未使用（设置成0)</td></tr>\n<tr>\n<td>hashvalue</td><td>通过 md5 加密算法计算出的32位验证串</td></tr>\n</tbody></table></div></div><p><code>hashvalue</code> 计算方式如下：</p>\n<blockquote>\n<p>sstring = /{AppName}/{StreamName}-{timestamp}-{rand}-{uid}-{privatekey}<br>hashvalue = md5(sstring)</p>\n</blockquote>\n<p>输入OBS中的鉴权内容如下：</p>\n<blockquote>\n<p>rtmpURL：rtmp://video-center.alivecdn.com/{AppName}<br>流密钥：{StreamName}?vhost={yourdomain}&amp;auth_key={timestamp}-{rand}-{uid}-{hashvalue}</p>\n</blockquote>\n","prev":{"title":"iOS 购物车设计模式浅析及代码实现","link":"2017/analysis-of-ios-shopping-cart-design-pattern-and-code-implementation"},"next":{"title":"iOS 中 atomic 和 nonatomic 的区别","link":"2017/the-difference-between-the-atomic-and-nonatomic-attributes"},"plink":"https://blog.fiteen.top/2017/ali-cloud-live-authentication-algorithm/","toc":[{"id":"参数描述","title":"参数描述","index":"1"},{"id":"鉴权方法","title":"鉴权方法","index":"2"}],"reward":true,"copyright":{"author":"FiTeen","link":"<a href=\"https://blog.fiteen.top/2017/ali-cloud-live-authentication-algorithm/\" title=\"阿里云直播鉴权算法\">https://blog.fiteen.top/2017/ali-cloud-live-authentication-algorithm/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}